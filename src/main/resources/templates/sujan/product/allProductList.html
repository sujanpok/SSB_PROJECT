<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<section>
	<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet"
	href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
<script
	src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script
	src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
<script
	src="https://cdnjs.cloudflare.com/ajax/libs/jquery-validate/1.17.0/jquery.validate.min.js"></script>
<!-- Syncfusion Essential JS 2 Styles -->
<link rel="stylesheet"
	href="https://cdn.syncfusion.com/ej2/material.css" />

<!-- Syncfusion Essential JS 2 Scripts -->
<script src="https://cdn.syncfusion.com/ej2/dist/ej2.min.js"></script>
<script>
    //product register
        function show_modal(e)
{
    $('#myModal').modal('show');
    return false;
}
        
        //detail product
        function show_modal_product(id,productName,productPrize,productStock,productImageUrl)
        {
            $('#myModaldetail').modal('show');
            document.getElementById("delete_product").value = id;
            document.getElementById("proName").innerHTML = "商品名："+productName;
           document.getElementById("proPrize").innerHTML = "単価："+productPrize+"円";
           // document.getElementById("p1").innerHTML = "New text!";
            document.getElementById("proStock").innerHTML = "在庫数量："+productStock;
            if(productImageUrl!==null){
            document.getElementById("proImg").src =productImageUrl;
            }
            //var message = id+productName+productPrize+productStock;
           // alert(message);
            return false;
        }
        
        
        
     function validateForm() {
    	 let name=document.forms["addData"]["productName"].value;
    	 let prize=document.forms["addData"]["productPrize"].value;
    	 //let file=document.forms["addData"]["productImage"].value;
    	 let stock=document.forms["addData"]["productStock"].value;
    	 if(stock==""||stock==0){
    		 alert("在庫は入力は必須です。\n(ZERO)対象外");
    		 return false;
    	 }
    	 if(name==""||prize==""||stock==""||stock==0){
    		 return false;
    	 }else{
    		 return true;
    	 }
     }  
      // Initialize the uploader component
   /*  var uploadObj = new ej.inputs.Uploader({
        asyncSettings: {
            saveUrl: 'file:///C:/Users/pokha/git/SSB_PROJECT/src/main/resources/static/img/sujan/productImg/',
            removeUrl: 'file:///C:/Users/pokha/git/SSB_PROJECT/src/main/resources/static/img/sujan/productImg/'
        },
        removing: onFileRemove,
        allowedExtensions: ".jpg,.png,.jpeg"
    });
    uploadObj.appendTo('#productImage'); */
    function myFunction(id) {
    	  document.getElementById("deleteproData").action =id+"/delete";
    	  return false;
    }
    </script>
<style>
.card {
	box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2);
	max-width: 300px;
	margin: auto;
	text-align: center;
	font-family: arial;
}

.price {
	color: grey;
	font-size: 22px;
}

.card button {
	border: none;
	outline: 0;
	padding: 12px;
	color: white;
	background-color: #000;
	text-align: center;
	cursor: pointer;
	width: 60%;
	font-size: 18px;
}

.card button:hover {
	opacity: 0.7;
}
</style>
	</head>
	<body class=" bg-light">

		<div class="container-fluid ">

			<p class="text-end ">
				<a class="btn btn-primary" type="button" th:href="@{/home}">ホームページ
					戻る </a>
			</p>
			<a class="btn btn-primary" type="button" th:href="@{/csv}">CSV
				ダウンロード </a>
			<p>
			<a class="btn btn-primary" type="button" th:href="@{/pdf}">PDF
				ダウンロード </a>
			</p>
			<a class="btn btn-primary" type="button" id="addProduct"
				th:onclick="|return show_modal(this);|">商品追加</a>
			<p>

			<h2 class="text-danger text-left">
				<span th:text="${message}"></span>
			</h2>

		</div>
		<section th:if="${productListcount>0}">

			<nav aria-label="Page navigation example">

				<ul class="pagination">

					<li th:if="${currentPage !=0}" class="page-item "><a
						th:href="@{${currentPage-1}}" class="page-link" href="#">Previous</a>
					</li>
					<li th:classappend="${currentPage==i-1?'active':''}"
						th:each="i: ${#numbers.sequence(1,totalPage)}" class="page-item">
						<a th:href="@{${i-1}}" class="page-link" href="#"> <span
							th:text="${i}"></span></a>
					</li>
					<li th:if="${currentPage+1!=totalPage}" class="page-item"><a
						th:href="@{${currentPage+1}}" class="page-link" href="#">Next</a>
					</li>
				</ul>
			</nav>
			<hr>
			<h1 class="my-2">商品一覧</h1>
			<table class="table table-borderd table-striped">
				<tr>
					<th>ID</th>
					<th>商品名</th>
					<th>単価</th>
					<th>在庫数量</th>
					<th colspan="3">編集</th>
				</tr>
				<tr th:each="product : ${productList}">
					<td th:text="${product.id}"></td>
					<td th:text="${product.productName}"></td>
					<td th:text="${product.productPrize}"></td>
					<td th:text="${product.productImageName}"></td>
					<td th:text="${product.productStock}"></td>


					<td>
					<td><a th:data_id="|${product.id}|"
						th:data_name="|${product.productName}|"
						th:data_prize="|${product.productPrize}|"
						th:data_stock="|${product.productStock}|"
						th:data_imgUrl="|${product.productImageUrl}|"
						th:onclick="|return show_modal_product(this.getAttribute('data_id'),this.getAttribute('data_name'),
                     this.getAttribute('data_prize'),this.getAttribute('data_stock'),this.getAttribute('data_imgUrl'));|"
						class="btn btn-secondary">詳細</a></td>
				</tr>
				<!--   th:href="@{detail/{id}(id=*{product.id})}" -->


			</table>
		</section>
		<section th:unless="${productListcount>0}">
			<h1 class="text-center">商品情報ありません。登録してください。</h1>
		</section>
		<div class="modal fade" id="myModal">
			<div class="modal-dialog">
				<div class="modal-content">
					<div class="modal-header">
						<h4 class="modal-title">登録する商品の情報を入力してください</h4>
					</div>
					<div class="modal-body">
						<form method="post" enctype="multipart/form-data"
							th:onsubmit="return validateForm()" th:action="@{/addProduct}"
							name="addData" th:object="${productForm}">
							<!-- " -->
							<div class="w-50">
								<label for="name" class="form-label h6">商品名:</label> <input
									type="text" class="form-control" id="productName"
									name="productName" th:text="${productName}"
									th:value="${productName}" required>
							</div>
							<div class="w-50">
								<label for="email" class="form-label h6">単価:</label> <input
									type="text" class="form-control" id="productPrize"
									name="productPrize" th:text="${productPrize}"
									th:value="${productPrize}" required
									onkeyup="if (/\D/g.test(this.value)) this.value = this.value.replace(/\D/g,'')">円
							</div>
							<div class="w-50">
								<label for="email" class="form-label h6">商品画像:</label> <input
									type="file" class="form-control" id="productImage" name="image"
									accept="image/*" required>
							</div>
							<div class="w-50">
								<label for="email" class="form-label h6">在庫:</label> <input
									type="text" class="form-control" id="productStock"
									name="productStock" th:text="${productStock}"
									th:value="${productStock}"
									onkeyup="if (/\D/g.test(this.value)) this.value = this.value.replace(/\D/g,'')"><br>
							</div>

							<div class="text-center pt-3">
								<input type="submit" class="display-6" value="登録する">
							</div>
						</form>
					</div>
					<div class="modal-footer">
						<button type="button" class="btn btn-default" data-dismiss="modal">閉じる</button>
					</div>
				</div>
			</div>
		</div>
		<div class="modal fade" id="myModaldetail">
			<div class="modal-dialog">
				<div class="modal-content">
					<div class="modal-header">
						<h4 style="text-align: center">商品詳細</h4>
					</div>
					<div class="modal-body">
						<form method="get" id="deleteproData" name="deleteData">
							<div class="card">
								<img id="proImg" th:src="@{/img/sujan/login.png}"
									alt="productImg" style="width: 100%">
								<h3 id="proName">商品名：</h3>
								<p id="proPrize" class="price">単価：円</p>
								<p id="proStock" class="price">在庫数量：</p>
								<p>
									<button type="submit" id="delete_product"
										th:onclick="|myFunction(this.value);|" value="">削除する</button>
								<p>

									<!-- class="button_delete" name="delete_product"  -->
							</div>
						</form>
					</div>
					<div class="modal-footer">
						<button type="button" class="btn btn-default" data-dismiss="modal">閉じる</button>
					</div>
				</div>
			</div>
		</div>
	</body>
</section>
</html>